<script>
    async function getWeather(lat, lon) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
        const res = await fetch(url);
        const data = await res.json();

        const tempC = data?.current_weather?.temperature ?? "?";
        const wind = data?.current_weather?.windspeed ?? "?";
        const code = data?.current_weather?.weathercode ?? null;

        document.getElementById("weather-info").innerHTML = `
      <h3>Weather Details</h3>
      <p><strong>Latitude:</strong> ${Number(lat).toFixed(2)}</p>
      <p><strong>Longitude:</strong> ${Number(lon).toFixed(2)}</p>
      <p><strong>Temperature:</strong> ${tempC} Â°C</p>
      <p><strong>Condition:</strong> ${weatherCodeToText(code)}</p>
      <p><strong>Wind Speed:</strong> ${wind} km/h</p>
    `;
    }

    function weatherCodeToText(code) {
        const map = {
            0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
            45: "Fog", 48: "Depositing rime fog",
            51: "Light drizzle", 53: "Moderate drizzle", 55: "Dense drizzle",
            61: "Slight rain", 63: "Moderate rain", 65: "Heavy rain",
            71: "Slight snow", 73: "Moderate snow", 75: "Heavy snow",
            95: "Thunderstorm", 99: "Thunderstorm with hail"
        };
        return map[code] ?? "Unknown";
    }

    function initMap() {
        const boston = { lat: 42.3601, lng: -71.0589 };
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 8, center: boston
        });

        map.addListener("click", (e) => {
            const lat = e.latLng.lat();
            const lon = e.latLng.lng();
            getWeather(lat, lon);
        });
    }
</script>